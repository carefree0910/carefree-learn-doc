<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.68">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><title data-react-helmet="true">Build Your Own Models | carefree-learn</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Build Your Own Models | carefree-learn"><meta data-react-helmet="true" name="description" content="In this page we will go through some basic concepts we need to know to build our own models in carefree-learn. Customizing carefree-learn could be very easy if you only want to construct existing modules to form a new model structure, and should also be fairly straight forward even if you want to implement your own modules."><meta data-react-helmet="true" property="og:description" content="In this page we will go through some basic concepts we need to know to build our own models in carefree-learn. Customizing carefree-learn could be very easy if you only want to construct existing modules to form a new model structure, and should also be fairly straight forward even if you want to implement your own modules."><meta data-react-helmet="true" property="og:url" content="https://carefree0910.me/carefree-learn-doc/docs/developer-guides/customization"><link data-react-helmet="true" rel="shortcut icon" href="/carefree-learn-doc/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://carefree0910.me/carefree-learn-doc/docs/developer-guides/customization"><link rel="stylesheet" href="/carefree-learn-doc/styles.fd85c772.css">
<link rel="preload" href="/carefree-learn-doc/styles.18d5c89f.js" as="script">
<link rel="preload" href="/carefree-learn-doc/runtime~main.4ceea648.js" as="script">
<link rel="preload" href="/carefree-learn-doc/main.e3ede4e9.js" as="script">
<link rel="preload" href="/carefree-learn-doc/1.8cf15f2e.js" as="script">
<link rel="preload" href="/carefree-learn-doc/40.5f50ff8e.js" as="script">
<link rel="preload" href="/carefree-learn-doc/42.722e87cd.js" as="script">
<link rel="preload" href="/carefree-learn-doc/935f2afb.1b418ced.js" as="script">
<link rel="preload" href="/carefree-learn-doc/39.dbcd0e74.js" as="script">
<link rel="preload" href="/carefree-learn-doc/47e7c29a.c1e1dd4a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/carefree-learn-doc/"><strong class="navbar__title">carefree-learn</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/carefree-learn-doc/docs/">Docs</a><a class="navbar__item navbar__link" href="/carefree-learn-doc/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/carefree0910/carefree-learn" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/carefree-learn-doc/"><strong class="navbar__title">carefree-learn</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/carefree-learn-doc/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/carefree-learn-doc/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/carefree0910/carefree-learn" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive thin-scrollbar menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">carefree-learn</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/carefree-learn-doc/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/carefree-learn-doc/docs/design-principles">Design Principles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/carefree-learn-doc/docs/optimizations">Optimizations</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/carefree-learn-doc/docs/getting-started/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/carefree-learn-doc/docs/getting-started/quick-start">Quick Start</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/carefree-learn-doc/docs/getting-started/configurations">Configurations</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">User Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/carefree-learn-doc/docs/user-guides/auto-ml">AutoML</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/carefree-learn-doc/docs/user-guides/distributed">Distributed</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/carefree-learn-doc/docs/user-guides/production">Production</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/carefree-learn-doc/docs/user-guides/examples">Examples</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Developer Guides</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/carefree-learn-doc/docs/developer-guides/customization">Customization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/carefree-learn-doc/docs/developer-guides/contributing">Contributing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/carefree-learn-doc/docs/developer-guides/code-of-conduct">Code of Conduct</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/carefree-learn-doc/docs/about/release-notes">Release Notes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/carefree-learn-doc/docs/about/license">License</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Build Your Own Models</h1></header><div class="markdown"><p>In this page we will go through some basic concepts we need to know to build our own models in <code>carefree-learn</code>. Customizing <code>carefree-learn</code> could be very easy if you only want to construct existing modules to form a new model structure, and should also be fairly straight forward even if you want to implement your own modules.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>There&#x27;s a step-by-step example <a href="/carefree-learn-doc/docs/user-guides/examples#operations">here</a> which will walk you through the most important concepts with sufficient codes and experiments.</p></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>In order to better understand the following contents, it is recommended to first understand the basic concepts mentioned in the <a href="/carefree-learn-doc/docs/design-principles#model">Design Principles</a>.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configs"></a><code>Configs</code><a aria-hidden="true" class="hash-link" href="#configs" title="Direct link to heading">#</a></h2><p>Before we dive into the details of customization, we should first understand how <code>carefree-learn</code> manages its <code>Configs</code>. It is actually not more than an ordinary Python <code>dict</code>, except it can be <em>registered</em> in a certain <em>hierarchy</em> format. Basically, a <code>Configs</code> need to define a <code>scope</code> and a <code>name</code> for users to access it, where</p><ul><li>A <code>scope</code> represents a <code>module</code>. </li><li>A <code>name</code> represents the different <code>version</code> of the corresponding configuration.</li></ul><p>For example, if we want to configure a <code>module</code> named <code>Foo</code> with different <code>dummy_value</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Foo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dummy_value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dummy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> dummy_value</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dummy</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Then we can leverage <code>cflearn.register_config</code> to register different configurations:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> cflearn</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;one&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;dummy_value&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;two&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;dummy_value&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Notice that we&#x27;ve implemented <code>get_default</code> for each class, which is the only necessary method we need to inherit from <code>Configs</code>.</p></div></div><p>After registration, we can access them through their names, which is very convenient in many use cases (e.g. hyper parameter optimization):</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> name </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;one&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;two&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    cfg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Configs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cfg</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pop</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    Foo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">**</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1.0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2.0</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Notice that we used <code>Configs.pop</code> to generate a Python <code>dict</code> for further usages.</p></div></div><p>What&#x27;s going on under the hood is that <code>carefree-learn</code> maintains a global <code>configs_dict</code> with following hierarchy:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;scope_0&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;name_00&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config_class_00</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;name_01&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config_class_01</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;scope_1&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;name_10&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config_class_10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;name_11&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config_class_11</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;scope_k&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;name_k0&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config_class_k0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;name_k1&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> config_class_k1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>So after the registration mentioned above, this global <code>configs_dict</code> will be updated to:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;foo&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;one&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> FooOneConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;two&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> FooTwoConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="headconfigs"></a><code>HeadConfigs</code><a aria-hidden="true" class="hash-link" href="#headconfigs" title="Direct link to heading">#</a></h3><p>A <code>HeadConfigs</code> inherits from <code>Configs</code> and holds more information. The reason why we implement an extra sub-class of <code>Configs</code> is that we usually need more information in <code>head</code> than in <code>transform</code> and <code>extractor</code>. For instance, we need to know the data dimensions to inference the default <code>output_dim</code>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>We need to call <code>cflearn.register_head_config</code> if we want to register a new <code>HeadConfigs</code>.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="constructing-existing-modules"></a>Constructing Existing Modules<a aria-hidden="true" class="hash-link" href="#constructing-existing-modules" title="Direct link to heading">#</a></h2><p>With the help of <code>Configs</code>, constructing existing modules is pretty easy because we can access different configurations by specifying their <code>scope</code> and <code>name</code>. In fact, as mentioned in <a href="/carefree-learn-doc/docs/design-principles#examples"><code>Design Principles</code></a>, <code>carefree-learn</code> itself is actually implementing its models by such similar process:</p><div><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1w39 tabs__item--active">Linear</li><li role="tab" tabindex="0" aria-selected="false" class="tabs__item tabItem_1w39">FCNN</li><li role="tab" tabindex="0" aria-selected="false" class="tabs__item tabItem_1w39">Wide &amp; Deep</li><li role="tab" tabindex="0" aria-selected="false" class="tabs__item tabItem_1w39">RNN</li><li role="tab" tabindex="0" aria-selected="false" class="tabs__item tabItem_1w39">Transformer</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@ModelBase</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">register</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;linear&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">@ModelBase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;linear&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">LinearModel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ModelBase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pass</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@ModelBase</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">register</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;fcnn&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">@ModelBase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;fcnn&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">FCNN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ModelBase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pass</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@ModelBase</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">register</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;wnd&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">@ModelBase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;fcnn&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> transform</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;embedding&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">@ModelBase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;linear&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> transform</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;one_hot_only&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">WideAndDeep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ModelBase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pass</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@ModelBase</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">register</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;rnn&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">@ModelBase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;rnn&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> head</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;fcnn&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">RNN</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ModelBase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pass</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token decorator annotation punctuation" style="color:#393A34">@ModelBase</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">register</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;transformer&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">@ModelBase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;transformer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> head</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;fcnn&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Transformer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ModelBase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">pass</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="modelbaseregister"></a><code>ModelBase.register</code><a aria-hidden="true" class="hash-link" href="#modelbaseregister" title="Direct link to heading">#</a></h3><p>In <code>carefree-learn</code> we implemented an alias for <code>ModelBase.register</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">register_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Callable</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Type</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Type</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ModelBase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>It can be used to register a new model and access it through its name, which is very convenient in many use cases (e.g. hyper parameter optimization).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="modelbaseregister_pipe"></a><code>ModelBase.register_pipe</code><a aria-hidden="true" class="hash-link" href="#modelbaseregister_pipe" title="Direct link to heading">#</a></h3><p>In <code>carefree-learn</code> we implemented an alias for <code>ModelBase.register_pipe</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">register_pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    transform</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;default&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    extractor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    head</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    extractor_config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;default&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    head_config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;default&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    extractor_meta_scope</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    head_meta_scope</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Callable</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">Type</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Type</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> ModelBase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_pipe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        transform</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">transform</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        extractor</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">extractor</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        head</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">head</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        extractor_config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">extractor_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        head_config</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">head_config</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        extractor_meta_scope</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">extractor_meta_scope</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        head_meta_scope</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">head_meta_scope</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>In this definition, the <code>extractor</code> and <code>head</code> arguments represent the corresponding <code>scope</code>, while <code>transform</code>, <code>extractor_config</code> and <code>head_config</code> represent the corresponding <code>name</code>. In other words, this definition actually means:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">transform_cfg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Configs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;transform&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> transform</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">extractor_cfg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Configs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">extractor</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> extractor_config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">head_cfg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HeadConfigs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">head</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> head_config</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li>There is only one <code>scope</code> for <code>transform</code> because the number of choices of <code>transform</code> is limited (see <a href="/carefree-learn-doc/docs/design-principles#transform">transform</a> for more details).</li><li>We are using <code>cflearn.HeadConfigs</code> to fetch configurations for <code>head</code>, as mentioned in <a href="#headconfigs">HeadConfigs</a> section.</li></ul></div></div><p>Besides these, there still remains a <code>key</code> argument in <code>register_pipe</code> and this is where many default logics hide under the hood:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> head </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    head </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> key</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> extractor </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    extractor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> key</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> extractor </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    extractor </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;identity&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>These logics simplify the definitions of some common structures, so in <code>carefree-learn</code> we only care about the <code>key</code> argument in most cases.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>For the <code>key</code> itself, we only need to guarantee that different <a href="/carefree-learn-doc/docs/design-principles#pipe">pipe</a> corresponds to different <code>key</code>.</p></div></div><p>At the last part of this section, we will demonstrate how could we build a new model with following properties:</p><ul><li>Use one hot features to train a <code>DNDF</code> <code>head</code>.</li><li>Use one hot features and numerical features to train a <code>linear</code> <code>head</code>.</li><li>Use numerical features to train an <code>fcnn</code> <code>head</code>.</li><li>Use embedding features to train an <code>fcnn</code> <code>head</code>.</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> cflearn</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;brand_new_model&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    pipes</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PipeInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;dndf&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> transform</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;one_hot_only&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PipeInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;linear&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> transform</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;one_hot&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PipeInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;fcnn&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> transform</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;numerical&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PipeInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;fcnn2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> transform</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;embedding_only&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> extractor</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;identity&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> head</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;fcnn&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>We can actually play with it:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">numerical </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">categorical </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">randint</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">hstack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">numerical</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> categorical</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">m </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;brand_new_model&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">m</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><details><summary><b>Which yields</b></summary><p></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-text codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">_(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  (pipes): Pipes(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (dndf): one_hot_only_identity_default -&gt; dndf_default</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (linear): one_hot_identity_default -&gt; linear_default</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (fcnn): numerical_identity_default -&gt; fcnn_default</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (fcnn2): embedding_only_identity_default -&gt; fcnn_default</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  (loss): L1Loss()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  (encoder): Encoder(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (embeddings): ModuleList(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (0): Embedding(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (core): Lambda(embedding: 50 -&gt; 4)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (one_hot_encoders): ModuleList(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (0): OneHot(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (core): Lambda(one_hot_10)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (1): OneHot(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (core): Lambda(one_hot_10)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (2): OneHot(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (core): Lambda(one_hot_10)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (3): OneHot(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (core): Lambda(one_hot_10)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (4): OneHot(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (core): Lambda(one_hot_10)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (embedding_dropout): Dropout(keep=0.8)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  (transforms): ModuleDict(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (one_hot_only): Transform(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (use_one_hot): True</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (use_embedding): False</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (only_categorical): True</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (one_hot): Transform(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (use_one_hot): True</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (use_embedding): False</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (only_categorical): False</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (numerical): Transform(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (use_one_hot): False</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (use_embedding): False</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (only_categorical): False</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (embedding_only): Transform(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (use_one_hot): False</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (use_embedding): True</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (only_categorical): True</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  (extractors): ModuleDict(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (one_hot_only_identity_default): Identity()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (one_hot_identity_default): Identity()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (numerical_identity_default): Identity()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (embedding_only_identity_default): Identity()</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  (heads): ModuleDict(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (dndf): DNDFHead(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (dndf): DNDF(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (tree_proj): Linear(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          (linear): Linear(in_features=50, out_features=310, bias=True)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          (pruner): Pruner(method=&#x27;auto_prune&#x27;)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (linear): LinearHead(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (linear): Linear(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (linear): Linear(in_features=55, out_features=1, bias=True)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (fcnn): FCNNHead(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (mlp): MLP(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (mappings): ModuleList(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          (0): Mapping(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (linear): Linear(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">              (linear): Linear(in_features=5, out_features=64, bias=False)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (bn): BN(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (activation): ReLU(inplace=True)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (dropout): Dropout(keep=0.5)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          (1): Mapping(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (linear): Linear(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">              (linear): Linear(in_features=64, out_features=64, bias=False)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (bn): BN(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (activation): ReLU(inplace=True)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (dropout): Dropout(keep=0.5)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          (2): Linear(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (linear): Linear(in_features=64, out_features=1, bias=True)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    (fcnn2): FCNNHead(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      (mlp): MLP(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        (mappings): ModuleList(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          (0): Mapping(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (linear): Linear(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">              (linear): Linear(in_features=20, out_features=64, bias=False)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (bn): BN(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (activation): ReLU(inplace=True)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (dropout): Dropout(keep=0.5)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          (1): Mapping(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (linear): Linear(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">              (linear): Linear(in_features=64, out_features=64, bias=False)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (bn): BN(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (activation): ReLU(inplace=True)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (dropout): Dropout(keep=0.5)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          (2): Linear(</span></div><div class="token-line" style="color:#393A34"><span class="token plain">            (linear): Linear(in_features=64, out_features=1, bias=True)</span></div><div class="token-line" style="color:#393A34"><span class="token plain">          )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">      )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">  )</span></div><div class="token-line" style="color:#393A34"><span class="token plain">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p></p></details><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="customizing-new-modules"></a>Customizing New Modules<a aria-hidden="true" class="hash-link" href="#customizing-new-modules" title="Direct link to heading">#</a></h2><p>In this section, we&#x27;ll introduce how to customize your own <a href="/carefree-learn-doc/docs/design-principles#extractor"><code>extractor</code></a> and <a href="/carefree-learn-doc/docs/design-principles#head"><code>head</code></a>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Currently <code>transform</code> is not customizable because <code>carefree-learn</code> sticks to <code>one_hot</code> and <code>embedding</code>. Please refer to <a href="/carefree-learn-doc/docs/design-principles#transform">Design Principles</a> for more details.</p></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Again, we recommend <a href="/carefree-learn-doc/docs/user-guides/examples#operations">this</a> step-by-step example which will walk you through the most important concepts with sufficient codes and experiments.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="customize-extractor"></a>Customize <code>extractor</code><a aria-hidden="true" class="hash-link" href="#customize-extractor" title="Direct link to heading">#</a></h3><p>Recap that an <a href="/carefree-learn-doc/docs/design-principles#extractor"><code>extractor</code></a> is responsible for extracting the (transformed) input data into latent features. For tabular datasets, it will simply be <code>identity</code> in most cases because we can hardly have any prior knowledge.</p><p>We can, however, inject prior knowledge into <code>carefree-learn</code> if we happen to have one. For example, if we have two features, namely <em>working hours</em> (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.61508em;vertical-align:0em"></span><span class="mord mathnormal">t</span></span></span></span></span>) and <em>wage</em> (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal">x</span></span></span></span></span>), and the target is to calculate the <em>actual income</em> (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.03588em">y</span></span></span></span></span>):</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>y</mi><mo>=</mo><mi>t</mi><mo>Ã—</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">y=t\times x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathnormal" style="margin-right:0.03588em">y</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.69841em;vertical-align:-0.08333em"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathnormal">x</span></span></span></span></span></div><p>Although this task seems easy to humans, it is actually quite difficult for Neural Networks because Neural Networks lack information of multiplication across features. We can run a small experiment to quickly demonstrate this:</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The example showing below is a simplified version of <a href="/carefree-learn-doc/docs/user-guides/examples#operations">Operations</a>.</p></div></div><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> cflearn</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">random</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">y </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">prod</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> axis</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> keepdims</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># `reg` represents a regression task</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># `use_simplify_data` indicates that `carefree-learn` will do nothing to the input data</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">kwargs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;task_type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;reg&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;use_simplify_data&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">fcnn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">evaluate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pipelines</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">fcnn</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>We&#x27;ve set <code>use_simplify_data</code> to <code>True</code>. That&#x27;s because we want to hold the datasets&#x27; property, so we should not apply any pre-processing strategies to the original dataset.</p></div></div><p>Which yields</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-text codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">================================================================================================================================</span></div><div class="token-line" style="color:#393A34"><span class="token plain">|        metrics         |                       mae                        |                       mse                        |</span></div><div class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">|                        |      mean      |      std       |     score      |      mean      |      std       |     score      |</span></div><div class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">|          fcnn          |    0.062123    |    0.000000    |    -0.06212    |    0.006766    |    0.000000    |    -0.00676    |</span></div><div class="token-line" style="color:#393A34"><span class="token plain">================================================================================================================================</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>We can see that <code>fcnn</code> failed to approach to the ground truth. In order to improve this, we can implement an <code>extractor</code> to generate a new feature representing cross-feature multiplication:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> torch</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># The name `cross_multiplication` is actually the `scope` of this `extractor`</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@cflearn</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">register_extractor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;cross_multiplication&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">CrossMultiplication</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ExtractorBase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># This property represents the dimension of this `extractor`&#x27;s output</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@property</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">out_dim</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># This is where your algorithms should be implemented</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># net.shape : [ batch_size, in_dim ]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">forward</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> net</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Tensor</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Tensor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        prod </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> net</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> net</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> prod</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">view</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>After defining the <code>extractor</code>, we need to (at least) define the <code>default</code> config under its <code>scope</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;cross_multiplication&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;default&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Since <code>CrossMultiplication</code> doesn&#x27;t really need any configurations, simply returning an empty Python <code>dict</code> will be enough.</p><p>With these two steps, we have already implemented a ready-to-use <code>extractor</code> which holds our prior knowledge, so the next step is to utilize it:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;multiplication&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    pipes</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PipeInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;linear&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> extractor</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;cross_multiplication&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>And that&#x27;s it! Because <code>carefree-learn</code> will do most of the boiler plates for you.</p><p>Let&#x27;s run a small experiment to demonstrate the validaty of our new model:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">mul </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;multiplication&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">evaluate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pipelines</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">fcnn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mul</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Which yields</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-text codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">================================================================================================================================</span></div><div class="token-line" style="color:#393A34"><span class="token plain">|        metrics         |                       mae                        |                       mse                        |</span></div><div class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">|                        |      mean      |      std       |     score      |      mean      |      std       |     score      |</span></div><div class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">|          fcnn          |    0.065125    | -- 0.000000 -- |    -0.06512    |    0.007785    | -- 0.000000 -- |    -0.00778    |</span></div><div class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">|     multiplication     | -- 0.000078 -- | -- 0.000000 -- | -- -0.00007 -- | -- 0.000000 -- | -- 0.000000 -- | -- -0.00000 -- |</span></div><div class="token-line" style="color:#393A34"><span class="token plain">================================================================================================================================</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>As we expected, the <code>multiplication</code> model approaches to the ground truthðŸ¥³</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="customize-head"></a>Customize <code>head</code><a aria-hidden="true" class="hash-link" href="#customize-head" title="Direct link to heading">#</a></h3><p>Although the result is satisfying, in most real-life cases it is hard to obtain such strong prior knowledges. Recap that <code>fcnn</code> fails because it lacks cross-feature information, so a model with cross-feature information should be able to solve this <em>total income</em> task, and that&#x27;s where Deep-and-Cross<sup id="fnref-1"><a href="#fn-1" class="footnote-ref">1</a></sup> network comes to rescue:</p><p><img alt="Cross Layer" src="/carefree-learn-doc/assets/images/cross-layer-4bb796af04e7e339bf417ec9fc608822.png"></p><p>Since <code>carefree-learn</code> has already implemented <a href="https://github.com/carefree0910/carefree-learn/blob/03edf2bd8cc32b7fe2ce30be6e4196adf7ab0bde/cflearn/modules/blocks.py#L508" target="_blank" rel="noopener noreferrer"><code>CrossBlock</code></a>, we can utilize it to build our <code>CrossHead</code> easily:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Optional</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">modules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">blocks </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Linear</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">modules</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">blocks </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> CrossBlock</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">misc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">toolkit </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Activations</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># The name `cross` is actually the `scope` of this `head`</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:#393A34">@cflearn</span><span class="token decorator annotation punctuation" style="color:#393A34">.</span><span class="token decorator annotation punctuation" style="color:#393A34">register_head</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;cross&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">CrossHead</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HeadBase</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> in_dim</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> out_dim</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> activation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in_dim</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> out_dim</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cross </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CrossBlock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in_dim</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> residual</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bias</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> activation </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">activation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">activation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Activations</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">activation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linear </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Linear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">in_dim</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> out_dim</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">forward</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> net</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Tensor</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Tensor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        net </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cross</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">net</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> net</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">activation </span><span class="token keyword" style="color:#00009f">is</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">            net </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">activation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">net</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linear</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">net</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>After defining the <code>head</code>, we need to (at least) define the <code>default</code> config under its <code>scope</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Notice that we need to call `register_head_config` for registering `HeadConfigs`, as mentioned in the `HeadConfigs` section</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># We need to define `activation` because `CrossHead` requires it</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># However we don&#x27;t need to define `in_dim` and `out_dim`, because `carefree-learn` will handle them for us!</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_head_config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;cross&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;default&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> head_config</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;activation&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>With these two steps, we have already implemented a ready-to-use <code>head</code> which can perform cross-feature operations, so the next step is to utilize it:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">register_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;cross&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pipes</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">PipeInfo</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;cross&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Again, that&#x27;s it! Let&#x27;s run a small experiment to demonstrate the validaty of our new model:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-python codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">cross </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">make</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;cross&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">**</span><span class="token plain">kwargs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">cflearn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">evaluate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pipelines</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">fcnn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mul</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cross</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>Which yields</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><div tabindex="0" class="prism-code language-text codeBlock_3iAC thin-scrollbar"><div class="codeBlockLines_b7E3" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token plain">================================================================================================================================</span></div><div class="token-line" style="color:#393A34"><span class="token plain">|        metrics         |                       mae                        |                       mse                        |</span></div><div class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">|                        |      mean      |      std       |     score      |      mean      |      std       |     score      |</span></div><div class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">|         cross          |    0.000178    | -- 0.000000 -- |    -0.00017    |    0.000000    | -- 0.000000 -- |    -0.00000    |</span></div><div class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">|          fcnn          |    0.064953    | -- 0.000000 -- |    -0.06495    |    0.007111    | -- 0.000000 -- |    -0.00711    |</span></div><div class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------------------------------------------------------------------</span></div><div class="token-line" style="color:#393A34"><span class="token plain">|     multiplication     | -- 0.000025 -- | -- 0.000000 -- | -- -0.00002 -- | -- 0.000000 -- | -- 0.000000 -- | -- -0.00000 -- |</span></div><div class="token-line" style="color:#393A34"><span class="token plain">================================================================================================================================</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button></div></div><p>As we expected, the <code>cross</code> model approaches to the ground truthðŸ¥³</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Notice that we&#x27;ve used <code>residual=False</code> in <code>CrossBlock</code>, which is the secret ingredient of why <code>cross</code> model can approach to the ground truth.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="conclusions"></a>Conclusions<a aria-hidden="true" class="hash-link" href="#conclusions" title="Direct link to heading">#</a></h3><p>The above two sections showed us how to customize our own <code>extractor</code> and <code>head</code>, which should be sufficient to implement most of the models targeting tabular datasets. <code>carefree-learn</code> actually supports more customizations (e.g. metrics, initializations, etc), but they are more of some tricks than the main part of an algorithm. We hope that this guide can help you leverage <code>carefree-learn</code> in your own tasks!</p><div class="footnotes"><hr><ol><li id="fn-1">Wang, Ruoxi, et al. â€œDeep &amp; cross network for ad click predictions.â€ Proceedings of the ADKDDâ€™17. 2017. 1-7. <a href="#fnref-1" class="footnote-backref">â†©</a></li></ol></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-11-22T07:56:30.000Z" class="docLastUpdatedAt_217_">11/22/2020</time></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/carefree-learn-doc/docs/user-guides/examples"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Examples</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/carefree-learn-doc/docs/developer-guides/contributing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Contributing Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configs" class="table-of-contents__link"><code>Configs</code></a><ul><li><a href="#headconfigs" class="table-of-contents__link"><code>HeadConfigs</code></a></li></ul></li><li><a href="#constructing-existing-modules" class="table-of-contents__link">Constructing Existing Modules</a><ul><li><a href="#modelbaseregister" class="table-of-contents__link"><code>ModelBase.register</code></a></li><li><a href="#modelbaseregister_pipe" class="table-of-contents__link"><code>ModelBase.register_pipe</code></a></li></ul></li><li><a href="#customizing-new-modules" class="table-of-contents__link">Customizing New Modules</a><ul><li><a href="#customize-extractor" class="table-of-contents__link">Customize <code>extractor</code></a></li><li><a href="#customize-head" class="table-of-contents__link">Customize <code>head</code></a></li><li><a href="#conclusions" class="table-of-contents__link">Conclusions</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/carefree-learn-doc/docs/getting-started/installation/">Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/carefree-learn-doc/docs/getting-started/quick-start">Quick Start</a></li><li class="footer__item"><a class="footer__link-item" href="/carefree-learn-doc/docs/design-principles/">Design Principles</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/carefree0910" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/carefree-learn-doc/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/carefree0910/carefree-learn" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2020 carefree-learn, carefree0910. Built with Docusaurus.</div></div></div></footer></div>
<script src="/carefree-learn-doc/styles.18d5c89f.js"></script>
<script src="/carefree-learn-doc/runtime~main.4ceea648.js"></script>
<script src="/carefree-learn-doc/main.e3ede4e9.js"></script>
<script src="/carefree-learn-doc/1.8cf15f2e.js"></script>
<script src="/carefree-learn-doc/40.5f50ff8e.js"></script>
<script src="/carefree-learn-doc/42.722e87cd.js"></script>
<script src="/carefree-learn-doc/935f2afb.1b418ced.js"></script>
<script src="/carefree-learn-doc/39.dbcd0e74.js"></script>
<script src="/carefree-learn-doc/47e7c29a.c1e1dd4a.js"></script>
</body>
</html>