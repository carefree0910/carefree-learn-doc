(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{100:function(e,t,a){"use strict";var n=a(0),r=a(101);t.a=function(){var e=Object(n.useContext)(r.a);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},101:function(e,t,a){"use strict";var n=a(0),r=Object(n.createContext)(void 0);t.a=r},103:function(e,t,a){"use strict";var n=a(0),r=a.n(n),l=a(100),i=a(97),o=a(52),b=a.n(o),c=37,p=39;t.a=function(e){var t=e.lazy,a=e.block,o=e.children,s=e.defaultValue,m=e.values,d=e.groupId,u=e.className,O=Object(l.a)(),j=O.tabGroupChoices,f=O.setTabGroupChoices,h=Object(n.useState)(s),N=h[0],g=h[1];if(null!=d){var _=j[d];null!=_&&_!==N&&m.some((function(e){return e.value===_}))&&g(_)}var v=function(e){g(e),null!=d&&f(d,e)},y=[];return r.a.createElement("div",null,r.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:Object(i.a)("tabs",{"tabs--block":a},u)},m.map((function(e){var t=e.value,a=e.label;return r.a.createElement("li",{role:"tab",tabIndex:0,"aria-selected":N===t,className:Object(i.a)("tabs__item",b.a.tabItem,{"tabs__item--active":N===t}),key:t,ref:function(e){return y.push(e)},onKeyDown:function(e){!function(e,t,a){switch(a.keyCode){case p:!function(e,t){var a=e.indexOf(t)+1;e[a]?e[a].focus():e[0].focus()}(e,t);break;case c:!function(e,t){var a=e.indexOf(t)-1;e[a]?e[a].focus():e[e.length-1].focus()}(e,t)}}(y,e.target,e)},onFocus:function(){return v(t)},onClick:function(){v(t)}},a)}))),t?Object(n.cloneElement)(o.filter((function(e){return e.props.value===N}))[0],{className:"margin-vert--md"}):r.a.createElement("div",{className:"margin-vert--md"},o.map((function(e,t){return Object(n.cloneElement)(e,{key:t,hidden:e.props.value!==N})}))))}},104:function(e,t,a){"use strict";var n=a(3),r=a(0),l=a.n(r);t.a=function(e){var t=e.children,a=e.hidden,r=e.className;return l.a.createElement("div",Object(n.a)({role:"tabpanel"},{hidden:a,className:r}),t)}},156:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/files/image-folder-data-e9a48a43256cb31c5922a9ddd51acf44.png"},157:function(e,t,a){"use strict";a.r(t),t.default=a.p+"assets/images/image-folder-data-e9a48a43256cb31c5922a9ddd51acf44.png"},81:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return b})),a.d(t,"metadata",(function(){return c})),a.d(t,"rightToc",(function(){return p})),a.d(t,"default",(function(){return m}));var n=a(3),r=a(7),l=(a(0),a(96)),i=a(103),o=a(104),b={id:"computer-vision",title:"Computer Vision \ud83d\uddbc\ufe0f"},c={unversionedId:"user-guides/computer-vision",id:"user-guides/computer-vision",isDocsHomePage:!1,title:"Computer Vision \ud83d\uddbc\ufe0f",description:"+ For general introduction on how to use carefree-learn, please refer to the General section.",source:"@site/docs/user-guides/computer-vision.md",slug:"/user-guides/computer-vision",permalink:"/carefree-learn-doc/docs/user-guides/computer-vision",version:"current",lastUpdatedAt:1634636573,sidebar:"docs",previous:{title:"General",permalink:"/carefree-learn-doc/docs/user-guides/general"},next:{title:"Machine Learning \ud83d\udcc8",permalink:"/carefree-learn-doc/docs/user-guides/machine-learning"}},p=[{value:"Introduction",id:"introduction",children:[{value:"Generation",id:"generation",children:[]},{value:"Classification",id:"classification",children:[]},{value:"Segmentation",id:"segmentation",children:[]}]},{value:"<code>ImageFolderData</code>",id:"imagefolderdata",children:[{value:"Design Principles",id:"design-principles",children:[]},{value:"Unified IFD",id:"unified-ifd",children:[]},{value:"<code>prepare_image_folder</code>",id:"prepare_image_folder",children:[]},{value:"<code>_PreparationProtocol</code>",id:"_preparationprotocol",children:[]},{value:"<code>ImageFolderData</code>",id:"imagefolderdata-1",children:[]},{value:"<code>prepare_image_folder_data</code>",id:"prepare_image_folder_data",children:[]}]},{value:"Transforms",id:"transforms",children:[]}],s={rightToc:p};function m(e){var t=e.components,b=Object(r.a)(e,["components"]);return Object(l.b)("wrapper",Object(n.a)({},s,b,{components:t,mdxType:"MDXLayout"}),Object(l.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(l.b)("h5",{parentName:"div"},Object(l.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(l.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(l.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(l.b)("ul",{parentName:"div"},Object(l.b)("li",{parentName:"ul"},"For general introduction on how to use ",Object(l.b)("inlineCode",{parentName:"li"},"carefree-learn"),", please refer to the ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"general"}),"General")," section."),Object(l.b)("li",{parentName:"ul"},"For development guide, please refer to the ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"../developer-guides/computer-vision-customization"}),"Developer Guides")," section.")))),Object(l.b)("h2",{id:"introduction"},"Introduction"),Object(l.b)("p",null,"In this section, we will introduce how to utilize ",Object(l.b)("inlineCode",{parentName:"p"},"carefree-learn")," to solve computer vision tasks."),Object(l.b)("p",null,"What differs computer vision tasks to other deep learning tasks most is that, most of the dataset could be interpreted as '",Object(l.b)("strong",{parentName:"p"},"Image Folder Dataset"),"' (abbr: ",Object(l.b)("strong",{parentName:"p"},"IFD"),"). In this case, the source images (which will be the input of our models) will be stored in certain folder structure, and the labels (which will be the target of our models) can be represented by the hierarchy of each image file."),Object(l.b)("p",null,"Therefore, ",Object(l.b)("inlineCode",{parentName:"p"},"carefree-learn")," introduces ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#imagefolderdata"}),Object(l.b)("inlineCode",{parentName:"a"},"ImageFolderData"))," as the unified data api for computer vision tasks. We will first introduce how different tasks could be represented as ",Object(l.b)("strong",{parentName:"p"},"IFD"),", and will then introduce how to construct ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#imagefolderdata"}),Object(l.b)("inlineCode",{parentName:"a"},"ImageFolderData"))," in the next section."),Object(l.b)("h3",{id:"generation"},"Generation"),Object(l.b)("p",null,"Since generation tasks (usually) don't require labels, any image folder will be ",Object(l.b)("strong",{parentName:"p"},"IFD")," itself."),Object(l.b)("h3",{id:"classification"},"Classification"),Object(l.b)("p",null,"There are many ways to construct classification tasks as ",Object(l.b)("strong",{parentName:"p"},"IFD"),":"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Specify labels with the sub-folders' names."),Object(l.b)("li",{parentName:"ul"},"Specify labels with a ",Object(l.b)("inlineCode",{parentName:"li"},".csv")," file, in which each row contains a file name and its corresponding label.")),Object(l.b)(i.a,{defaultValue:"folder",values:[{label:"Folder Name",value:"folder"},{label:"CSV File",value:"csv"}],mdxType:"Tabs"},Object(l.b)(o.a,{value:"folder",mdxType:"TabItem"},Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"|--- data\n  |-- dog\n    |-- 0.png\n    |-- 1.png\n    ...\n  |-- cat\n    |-- 0.png\n    |-- 1.png\n    ...\n  ...\n"))),Object(l.b)(o.a,{value:"csv",mdxType:"TabItem"},Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"|--- data\n  |-- labels.csv\n  |-- images\n    |-- 0.png\n    |-- 1.png\n    ...\n")),Object(l.b)("p",null,Object(l.b)("strong",{parentName:"p"},"labels.csv")),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-csv"}),"0.png,dog\n1.png,cat\n")))),Object(l.b)("h3",{id:"segmentation"},"Segmentation"),Object(l.b)("p",null,"The simplest way to construct segmentation tasks as ",Object(l.b)("strong",{parentName:"p"},"IFD")," is to mimic the image folder structure and replace ",Object(l.b)("inlineCode",{parentName:"p"},".png")," (image file) with ",Object(l.b)("inlineCode",{parentName:"p"},".npy")," (mask file)."),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"|--- data\n  |-- images\n    |-- 0.png\n    |-- 1.png\n    ...\n  |-- masks\n    |-- 0.npy\n    |-- 1.npy\n")),Object(l.b)("h2",{id:"imagefolderdata"},Object(l.b)("inlineCode",{parentName:"h2"},"ImageFolderData")),Object(l.b)("p",null,Object(l.b)("inlineCode",{parentName:"p"},"carefree-learn")," provides a convenient API (see ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#prepare_image_folder_data"}),Object(l.b)("inlineCode",{parentName:"a"},"prepare_image_folder_data")),") to construct ",Object(l.b)("inlineCode",{parentName:"p"},"ImageFolderData"),". But before we dive into details, it's necessary to know how ",Object(l.b)("inlineCode",{parentName:"p"},"carefree-learn")," organizes its ",Object(l.b)("strong",{parentName:"p"},"IFD")," and how does it convert an ",Object(l.b)("strong",{parentName:"p"},"IFD")," to the final ",Object(l.b)("inlineCode",{parentName:"p"},"ImageFolderData"),"."),Object(l.b)("h3",{id:"design-principles"},"Design Principles"),Object(l.b)("p",null,"Since every task may have its own image folder structure, it will be very difficult to design a unified API to cover all the situations. ",Object(l.b)("inlineCode",{parentName:"p"},"carefree-learn")," therefore designs its ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#ifd-in-carefree-learn"}),"own ",Object(l.b)("strong",{parentName:"a"},"IFD")," pattern"),", and implements ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#prepare_image_folder"}),Object(l.b)("inlineCode",{parentName:"a"},"prepare_image_folder"))," to convert other image folder structure to this pattern:"),Object(l.b)("p",null,Object(l.b)("a",{target:"_blank",href:a(156).default}," ",Object(l.b)("img",{alt:"ImageFolderData",src:a(157).default})," ")),Object(l.b)("h3",{id:"unified-ifd"},"Unified IFD"),Object(l.b)("p",null,"In ",Object(l.b)("inlineCode",{parentName:"p"},"carefree-learn"),", we will expect the unified ",Object(l.b)("strong",{parentName:"p"},"IFD")," to be as follows:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"|--- data\n  |-- train\n    |-- xxx.png\n    |-- xxx.png\n    ...\n    |-- labels.json\n    |-- path_mapping.json\n  |-- valid\n    |-- xxx.png\n    |-- xxx.png\n    ...\n    |-- labels.json\n    |-- path_mapping.json\n  |-- idx2labels.json\n  |-- labels2idx.json\n  ...\n")),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"The ",Object(l.b)("inlineCode",{parentName:"p"},"train")," folder represents all data used in training."),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"We will call it the 'train split' in the future."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"The ",Object(l.b)("inlineCode",{parentName:"p"},"valid")," folder represents all data used in valitation."),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"We will call it the 'valid split' in the future."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"The ",Object(l.b)("inlineCode",{parentName:"p"},"labels.json")," in each split represents the label information:"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{\n    "/full/path/to/first.png": xxx,\n    "/full/path/to/second.png": xxx,\n    ...\n}\n')),Object(l.b)("p",{parentName:"li"},"  The keys will be the absolute paths of the images, and the values will be the corresponding labels."),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"If the labels are strings and end with ",Object(l.b)("inlineCode",{parentName:"li"},".npy"),", we will load the corresponding ",Object(l.b)("inlineCode",{parentName:"li"},"np.ndarray"),"."),Object(l.b)("li",{parentName:"ul"},"Other wise, the labels should be integers / floats and will be kept as-is."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"The ",Object(l.b)("inlineCode",{parentName:"p"},"path_mapping.json")," in each split represents the path mapping:"),Object(l.b)("pre",{parentName:"li"},Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{\n    "/full/path/to/first.png": "relative/path/to/original/first.png",\n    "/full/path/to/second.png": "relative/path/to/original/second.png",\n}\n')),Object(l.b)("p",{parentName:"li"},"  This means that the ",Object(l.b)("strong",{parentName:"p"},"IFD")," in ",Object(l.b)("inlineCode",{parentName:"p"},"carefree-learn")," should be a copy of the original ",Object(l.b)("strong",{parentName:"p"},"IFD"),", because we want to keep an individual version of each ",Object(l.b)("strong",{parentName:"p"},"IFD"),".")),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"The ",Object(l.b)("inlineCode",{parentName:"p"},"idx2labels.json")," represents the mapping from indices to original labels."),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"This is useful iff we are solving classification tasks and the original labels are strings."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("p",{parentName:"li"},"The ",Object(l.b)("inlineCode",{parentName:"p"},"labels2idx.json")," represents the mapping from original labels to indices."),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"This is useful iff we are solving classification tasks and the original labels are strings.")))),Object(l.b)("h3",{id:"prepare_image_folder"},Object(l.b)("inlineCode",{parentName:"h3"},"prepare_image_folder")),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),"def prepare_image_folder(\n    src_folder: str,\n    tgt_folder: str,\n    *,\n    to_index: bool,\n    prefix: Optional[str] = None,\n    preparation: _PreparationProtocol = DefaultPreparation(),\n    force_rerun: bool = False,\n    extensions: Optional[Set[str]] = None,\n    make_labels_in_parallel: bool = False,\n    num_jobs: int = 8,\n    train_all_data: bool = False,\n    valid_split: Union[int, float] = 0.1,\n    max_num_valid: int = 10000,\n    lmdb_config: Optional[Dict[str, Any]] = None,\n    use_tqdm: bool = True,\n) -> str:\n")),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"src_folder")),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Path of the original ",Object(l.b)("strong",{parentName:"li"},"IFD"),"."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"tgt_folder")),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify the path where we want to place our unified ",Object(l.b)("strong",{parentName:"li"},"IFD"),"."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"to_index")),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify whether should we turn the original labels to indices."),Object(l.b)("li",{parentName:"ul"},"This is useful iff we are solving classification tasks and the original labels are strings."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"prefix"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"None"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify the prefix of ",Object(l.b)("inlineCode",{parentName:"li"},"src_folder"),"."),Object(l.b)("li",{parentName:"ul"},"Sometimes this is useful when we need to customize our own ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"#_preparationprotocol"}),Object(l.b)("inlineCode",{parentName:"a"},"_PreparationProtocol")),"."),Object(l.b)("li",{parentName:"ul"},"See ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"#hierarchy"}),Object(l.b)("inlineCode",{parentName:"a"},"hierarchy"))," section for more details."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"preparation"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"DefaultPreparation()"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify the core logic of how to convert the original ",Object(l.b)("strong",{parentName:"li"},"IFD")," to our unified ",Object(l.b)("strong",{parentName:"li"},"IFD"),"."),Object(l.b)("li",{parentName:"ul"},"See ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"#_preparationprotocol"}),Object(l.b)("inlineCode",{parentName:"a"},"_PreparationProtocol"))," section for more details."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"force_rerun"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"False"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify whether should we force rerunning the whole prepare procedure."),Object(l.b)("li",{parentName:"ul"},"If ",Object(l.b)("inlineCode",{parentName:"li"},"False")," and caches are available, ",Object(l.b)("inlineCode",{parentName:"li"},"prepare_image_folder")," will be a no-op."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"extensions"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},'{".jpg", ".png"}'),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify the extensions of our target image files."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"make_labels_in_parallel"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"False"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Whether should we make labels in parallel."),Object(l.b)("li",{parentName:"ul"},"This will be very useful if making labels from the original ",Object(l.b)("strong",{parentName:"li"},"IFD")," is time consuming."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"num_jobs"))," ","[default = 8]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify the number of jobs when we are:",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"making labels in parallel."),Object(l.b)("li",{parentName:"ul"},"making a copy of the original ",Object(l.b)("strong",{parentName:"li"},"IFD")," to construct the unified ",Object(l.b)("strong",{parentName:"li"},"IFD"),"."))),Object(l.b)("li",{parentName:"ul"},"If ",Object(l.b)("inlineCode",{parentName:"li"},"0"),", then no parallelism will be used."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"train_all_data"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"False"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify whether should we use all available data as train split."),Object(l.b)("li",{parentName:"ul"},"Basically this means we will use train set + validation set to train our model, while the validation set will remain the same."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"valid_split"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"0.1"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify the number of samples in validation set."),Object(l.b)("li",{parentName:"ul"},"If ",Object(l.b)("inlineCode",{parentName:"li"},"float"),", it will represent the portion."),Object(l.b)("li",{parentName:"ul"},"If ",Object(l.b)("inlineCode",{parentName:"li"},"int"),", it will represent the exact number."),Object(l.b)("li",{parentName:"ul"},"Notice that the outcome of this argument will be effected by ",Object(l.b)("inlineCode",{parentName:"li"},"max_num_valid"),"."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"max_num_valid"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"10000"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify the maximum number of samples in validation set."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"lmdb_config"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"None"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify the configurations for ",Object(l.b)("inlineCode",{parentName:"li"},"lmdb"),"."),Object(l.b)("li",{parentName:"ul"},"If not provided, ",Object(l.b)("inlineCode",{parentName:"li"},"lmdb")," will not be utilized."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"use_tqdm"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"True"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify whether should we use ",Object(l.b)("inlineCode",{parentName:"li"},"tqdm")," progress bar to monitor the preparation progress.")))),Object(l.b)("h3",{id:"_preparationprotocol"},Object(l.b)("inlineCode",{parentName:"h3"},"_PreparationProtocol")),Object(l.b)("p",null,"In order to provide a convenient API to implement the core logic of converting the original ",Object(l.b)("strong",{parentName:"p"},"IFD")," to our unified ",Object(l.b)("strong",{parentName:"p"},"IFD"),", ",Object(l.b)("inlineCode",{parentName:"p"},"carefree-learn")," implemented ",Object(l.b)("inlineCode",{parentName:"p"},"_PreparationProtocol")," and exposed some methods for users to override. By default, ",Object(l.b)("inlineCode",{parentName:"p"},"carefree-learn")," will use ",Object(l.b)("inlineCode",{parentName:"p"},"DefaultPreparation")," which can handle some general cases:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),"class DefaultPreparation(_PreparationProtocol):\n    @property\n    def extra_labels(self) -> Optional[List[str]]:\n        return None\n\n    def filter(self, hierarchy: List[str]) -> bool:\n        return True\n\n    def get_label(self, hierarchy: List[str]) -> Any:\n        return 0\n    \n    def get_extra_label(self, label_name: str, hierarchy: List[str]) -> Any:\n        pass\n\n    def copy(self, src_path: str, tgt_path: str) -> None:\n        shutil.copyfile(src_path, tgt_path)\n")),Object(l.b)("p",null,"For specific cases, we can override one or more methods as shown above to customize the behaviours. We will first introduce these methods in details, and then will provide some examples on how to use it."),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"extra_labels")),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"This property specifies the extra labels required by current task."),Object(l.b)("li",{parentName:"ul"},"Usually we can safely leave it as ",Object(l.b)("inlineCode",{parentName:"li"},"None"),", unless we need to use multiple labels in one sample."),Object(l.b)("li",{parentName:"ul"},"See ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"#extra_labels-example"}),Object(l.b)("inlineCode",{parentName:"a"},"extra_labels")," example")," for more details."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"filter")),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"This method is used to filter out which images do we want to copy from the original ",Object(l.b)("strong",{parentName:"li"},"IFD"),"."),Object(l.b)("li",{parentName:"ul"},"Will be useful when:",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"the original ",Object(l.b)("strong",{parentName:"li"},"IFD")," contains some 'dirty' images (truncated, broken, etc.)."),Object(l.b)("li",{parentName:"ul"},"we only want to play with a specific portion of the original ",Object(l.b)("strong",{parentName:"li"},"IFD"),"."))),Object(l.b)("li",{parentName:"ul"},"See ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"#hierarchy"}),Object(l.b)("inlineCode",{parentName:"a"},"hierarchy"))," section for detailed definition of the ",Object(l.b)("inlineCode",{parentName:"li"},"hierarchy")," argument."),Object(l.b)("li",{parentName:"ul"},"See ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"#filter-example"}),Object(l.b)("inlineCode",{parentName:"a"},"filter")," example")," for more details."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"get_label")),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"This method is used to define the label of each input image."),Object(l.b)("li",{parentName:"ul"},"If returning string and ends with ",Object(l.b)("inlineCode",{parentName:"li"},".npy"),", it should represent an ",Object(l.b)("inlineCode",{parentName:"li"},"np.ndarray")," path, which will be loaded when constructing the input sample."),Object(l.b)("li",{parentName:"ul"},"If returning other strings, they will be converted to indices based on ",Object(l.b)("inlineCode",{parentName:"li"},"labels2idx.json"),"."),Object(l.b)("li",{parentName:"ul"},"If returning integer / float, they will be kept as-is."),Object(l.b)("li",{parentName:"ul"},"See ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"#hierarchy"}),Object(l.b)("inlineCode",{parentName:"a"},"hierarchy"))," section for detailed definition of the ",Object(l.b)("inlineCode",{parentName:"li"},"hierarchy")," argument."),Object(l.b)("li",{parentName:"ul"},"See ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"#get_label-example"}),Object(l.b)("inlineCode",{parentName:"a"},"get_label")," example")," for more details."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"get_extra_label")),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"This method is used to define the extra label(s) of each input image."),Object(l.b)("li",{parentName:"ul"},"If returning string and ends with ",Object(l.b)("inlineCode",{parentName:"li"},".npy"),", it should represent an ",Object(l.b)("inlineCode",{parentName:"li"},"np.ndarray")," path, which will be loaded when constructing the input sample."),Object(l.b)("li",{parentName:"ul"},"If returning other strings, they will be converted to indices based on ",Object(l.b)("inlineCode",{parentName:"li"},"labels2idx.json"),"."),Object(l.b)("li",{parentName:"ul"},"If returning integer / float, they will be kept as-is."),Object(l.b)("li",{parentName:"ul"},"See ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"#hierarchy"}),Object(l.b)("inlineCode",{parentName:"a"},"hierarchy"))," section for detailed definition of the ",Object(l.b)("inlineCode",{parentName:"li"},"hierarchy")," argument."),Object(l.b)("li",{parentName:"ul"},"See ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"#extra_labels-example"}),Object(l.b)("inlineCode",{parentName:"a"},"extra_labels")," example")," for more details."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"copy")),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"This method is used to copy images from the original ",Object(l.b)("strong",{parentName:"li"},"IFD")," to our unified ",Object(l.b)("strong",{parentName:"li"},"IFD"),"."),Object(l.b)("li",{parentName:"ul"},"Will be useful if we want to pre-check the quality of each image, because if this method raises an error, the corresponding image will be filtered out from the unified ",Object(l.b)("strong",{parentName:"li"},"IFD"),"."),Object(l.b)("li",{parentName:"ul"},"See ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"#copy-example"}),Object(l.b)("inlineCode",{parentName:"a"},"copy")," example")," for more details.")))),Object(l.b)("h4",{id:"hierarchy"},Object(l.b)("inlineCode",{parentName:"h4"},"hierarchy")),Object(l.b)("p",null,"A ",Object(l.b)("inlineCode",{parentName:"p"},"hierarchy")," in ",Object(l.b)("inlineCode",{parentName:"p"},"_PreparationProtocol")," is a list of string, representing the file hierarchy. For example, if the original ",Object(l.b)("strong",{parentName:"p"},"IFD")," looks as follows:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"|--- data\n  |-- dog\n    |-- 0.png\n    |-- 1.png\n    ...\n  |-- cat\n    |-- 0.png\n    |-- 1.png\n    ...\n  ...\n")),Object(l.b)("p",null,"Then the ",Object(l.b)("inlineCode",{parentName:"p"},"hierarchy")," of ",Object(l.b)("inlineCode",{parentName:"p"},"data/dog/0.png")," will be:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),'["data", "dog", "0.png"]\n')),Object(l.b)("p",null,"However, sometimes the original ",Object(l.b)("strong",{parentName:"p"},"IFD")," may locate on shared spaces, which means it will be difficult to get the relative path:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"|--- home\n  |-- shared\n    |-- data\n      |-- dog\n        |-- 0.png\n        |-- 1.png\n        ...\n      |-- cat\n        |-- 0.png\n        |-- 1.png\n        ...\n      ...\n  |-- you\n    |-- codes\n      |-- your_training_code.py\n")),Object(l.b)("p",null,"In this case, we can specify the ",Object(l.b)("inlineCode",{parentName:"p"},"prefix")," argument in ",Object(l.b)("inlineCode",{parentName:"p"},"prepare_image_folder"),":"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),'prepare_image_folder(\n    "data",\n    "/path/to/your/unifed/IFD,\n    prefix="/home/shared",\n    ...\n)\n')),Object(l.b)("p",null,"Here, ",Object(l.b)("inlineCode",{parentName:"p"},"src_folder")," is set to ",Object(l.b)("inlineCode",{parentName:"p"},'"data"')," and ",Object(l.b)("inlineCode",{parentName:"p"},"prefix")," is set to ",Object(l.b)("inlineCode",{parentName:"p"},'"/home/shared"'),", which means:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"We will use ",Object(l.b)("inlineCode",{parentName:"li"},'"/home/shared/data"')," as the final ",Object(l.b)("inlineCode",{parentName:"li"},"src_folder"),"."),Object(l.b)("li",{parentName:"ul"},"The ",Object(l.b)("inlineCode",{parentName:"li"},"hierarchy")," will strip out ",Object(l.b)("inlineCode",{parentName:"li"},'"/home/shared"'),", which means the ",Object(l.b)("inlineCode",{parentName:"li"},"hierarchy")," of ",Object(l.b)("inlineCode",{parentName:"li"},"/home/shared/data/dog/0.png")," will still be:")),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),'["data", "dog", "0.png"]\n')),Object(l.b)("p",null,"This mechanism can guarantee that the same ",Object(l.b)("inlineCode",{parentName:"p"},"_PreparationProtocol")," can be used across different environment (with only ",Object(l.b)("inlineCode",{parentName:"p"},"prefix")," modified), as long as the original ",Object(l.b)("strong",{parentName:"p"},"IFD")," has not changed."),Object(l.b)("h4",{id:"examples"},"Examples"),Object(l.b)("div",{className:"admonition admonition-info alert alert--info"},Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(l.b)("h5",{parentName:"div"},Object(l.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(l.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(l.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(l.b)("p",{parentName:"div"},"This section focuses on how to construct a unified ",Object(l.b)("strong",{parentName:"p"},"IFD"),". For how to construct a ",Object(l.b)("inlineCode",{parentName:"p"},"DLDataModule")," from a unifed ",Object(l.b)("strong",{parentName:"p"},"IFD"),", please refer to the ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"#imagefolderdata-1"}),"ImageFolderData")," section."))),Object(l.b)("h5",{id:"extra_labels-example"},Object(l.b)("inlineCode",{parentName:"h5"},"extra_labels")," example"),Object(l.b)("p",null,"Suppose the original ",Object(l.b)("strong",{parentName:"p"},"IFD")," looks as follows:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"|--- data\n  |-- labels.csv\n  |-- images\n    |-- 0.png\n    |-- 1.png\n    |-- 2.png\n    |-- 3.png\n    ...\n")),Object(l.b)("p",null,Object(l.b)("strong",{parentName:"p"},"labels.csv")),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-csv"}),"file,main_class,sub_class\n0.png,dog,little_dog\n1.png,cat,little_cat\n2.png,dog,large_dog\n3.png,cat,large_cat\n")),Object(l.b)("p",null,"Then the ",Object(l.b)("inlineCode",{parentName:"p"},"_PreparationProtocol")," could be defined as:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),'import cflearn\n\nclass MultiLabelsPreparation(cflearn.DefaultPreparation):\n    def __init__(self):\n        with open("data/labels.csv", "r") as f:\n            header = f.readline().strip().split(",")\n            self.sub_class_name = header[2]\n            self.classes, self.sub_classes = {}, {}\n            for line in f:\n                file, main_class, sub_class = line.strip().split(",")\n                self.classes[file] = main_class\n                self.sub_classes[file] = sub_class\n\n    @property\n    def extra_labels(self):\n        return [self.sub_class_name]\n\n    def get_label(self, hierarchy):\n        return self.classes[hierarchy[-1]]\n\n    def get_extra_label(self, label_name, hierarchy):\n        if label_name == self.sub_class_name:\n            return self.sub_classes[hierarchy[-1]]\n        raise NotImplementedError(f"\'{label_name}\' is not recognized")\n')),Object(l.b)("p",null,"After executing:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),'preparation = MultiLabelsPreparation()\ncflearn.prepare_image_folder(\n    "data",\n    "prepared",\n    to_index=True,\n    preparation=preparation,\n)\n')),Object(l.b)("p",null,"We will get the following unified ",Object(l.b)("strong",{parentName:"p"},"IFD"),":"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text",metastring:"{8,14,18-19}","{8,14,18-19}":!0}),"|--- data\n  ...\n|--- prepared\n  |-- train\n    |-- 0.png\n    |-- 3.png\n    |-- labels.json\n    |-- sub_class_labels.json\n    ...\n  |-- valid\n    |-- 1.png\n    |-- 2.png\n    |-- labels.json\n    |-- sub_class_labels.json\n    ...\n  |-- idx2labels.json\n  |-- labels2idx.json\n  |-- idx2sub_class.json\n  |-- sub_class2idx.json\n")),Object(l.b)("p",null,"The highlighted lines show the main differences when ",Object(l.b)("inlineCode",{parentName:"p"},"extra_labels")," mechanism is applied."),Object(l.b)("h5",{id:"filter-example"},Object(l.b)("inlineCode",{parentName:"h5"},"filter")," example"),Object(l.b)("p",null,"Suppose the original ",Object(l.b)("strong",{parentName:"p"},"IFD")," looks as follows:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"|--- home\n  |-- shared\n    |-- data\n      |-- dog\n        |-- 0.png\n        |-- 0_dummy.png\n        |-- 1.png\n        |-- 1_dummy.png\n        ...\n      |-- cat\n        |-- 0.png\n        |-- 1.png\n        |-- 1_dummy.png\n        ...\n      ...\n")),Object(l.b)("p",null,"And we don't want those image files that end with ",Object(l.b)("inlineCode",{parentName:"p"},"dummy")," to be in our unified ",Object(l.b)("strong",{parentName:"p"},"IFD"),". Then the ",Object(l.b)("inlineCode",{parentName:"p"},"_PreparationProtocol")," could be defined as:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),'import os\nimport cflearn\n\nclass FilterPreparation(cflearn.DefaultPreparation):\n    def filter(self, hierarchy):\n        name = os.path.splitext(hierarchy[-1])[0]\n        return not name.endswith("_dummy")\n')),Object(l.b)("h5",{id:"get_label-example"},Object(l.b)("inlineCode",{parentName:"h5"},"get_label")," example"),Object(l.b)("p",null,"Suppose the original ",Object(l.b)("strong",{parentName:"p"},"IFD")," looks as follows:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"|--- home\n  |-- shared\n    |-- data\n      |-- 0.png\n      |-- 1.png\n      |-- 2.png\n      ...\n")),Object(l.b)("p",null,"And the images are RGBA images, whose alpha channel will be our segmentation mask (label). Then the ",Object(l.b)("inlineCode",{parentName:"p"},"_PreparationProtocol")," could be defined as:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),'import os\nimport cflearn\nimport numpy as np\nfrom PIL import Image\n\nclass ExtractAlphaPreparation(cflearn.DefaultPreparation):\n    def __init__(self, prefix, labels_folder):\n        self.prefix = prefix\n        if prefix is None:\n            self.labels_folder = labels_folder\n        else:\n            self.labels_folder = os.path.join(prefix, labels_folder)\n        os.makedirs(self.labels_folder, exist_ok=True)\n\n    def get_label(self, hierarchy):\n        if self.prefix is not None:\n            hierarchy = [self.prefix] + hierarchy\n        img = Image.open(os.path.join(*hierarchy))\n        alpha = np.array(img)[..., -1]\n        name = os.path.splitext(hierarchy[-1])[0]\n        alpha_path = os.path.join(self.labels_folder, f"{name}.npy")\n        np.save(alpha_path, alpha)\n        return alpha_path\n\n    def copy(self, src_path, tgt_path):\n        img = Image.open(src_path).convert("RGB")\n        img.save(tgt_path)\n\n')),Object(l.b)("p",null,"After executing:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),'prefix = "/home/shared"\npreparation = ExtractAlphaPreparation(prefix, "labels")\ncflearn.prepare_image_folder(\n    "data",\n    "prepared",\n    to_index=False,\n    prefix=prefix,\n    preparation=preparation,\n)\n')),Object(l.b)("p",null,"We will get the following unified ",Object(l.b)("strong",{parentName:"p"},"IFD"),":"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text",metastring:"{3-7}","{3-7}":!0}),"|--- data\n  ...\n|--- labels\n  |-- 0.npy\n  |-- 1.npy\n  |-- 2.npy\n  |-- 3.npy\n|--- prepared\n  |-- train\n    |-- 1.png\n    |-- 2.png\n    |-- 3.png\n    |-- labels.json\n    ...\n  |-- valid\n    |-- 0.png\n    |-- labels.json\n    ...\n")),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"A ",Object(l.b)("inlineCode",{parentName:"li"},"labels")," folder will be created to store the extracted alpha mask."),Object(l.b)("li",{parentName:"ul"},"Neither ",Object(l.b)("inlineCode",{parentName:"li"},"idx2labels.json")," nor ",Object(l.b)("inlineCode",{parentName:"li"},"labels2idx.json")," will be generated, because all labels are ",Object(l.b)("inlineCode",{parentName:"li"},".npy")," files.")),Object(l.b)("h5",{id:"copy-example"},Object(l.b)("inlineCode",{parentName:"h5"},"copy")," example"),Object(l.b)("p",null,"The most common use case of overriding ",Object(l.b)("inlineCode",{parentName:"p"},"copy")," method is to pre-verify the original images:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),"import shutil\nimport cflearn\nfrom PIL import Image\n\nclass VerifyPreparation(cflearn.DefaultPreparation):\n    def copy(self, src_path, tgt_path):\n        Image.open(src_path).verify()\n        shutil.copyfile(src_path, tgt_path)\n")),Object(l.b)("h3",{id:"imagefolderdata-1"},Object(l.b)("inlineCode",{parentName:"h3"},"ImageFolderData")),Object(l.b)("div",{className:"admonition admonition-info alert alert--info"},Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(l.b)("h5",{parentName:"div"},Object(l.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(l.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(l.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(l.b)("p",{parentName:"div"},"In this section, we will use ",Object(l.b)("inlineCode",{parentName:"p"},"loader")," to represent ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"https://pytorch.org/docs/stable/data.html#torch.utils.data.DataLoader"}),"DataLoader")," from PyTorch."))),Object(l.b)("p",null,"After the unified ",Object(l.b)("strong",{parentName:"p"},"IFD")," is ready, constructing ",Object(l.b)("inlineCode",{parentName:"p"},"ImageFolderData")," will be fairly straightforward:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),'class CVDataModule(DLDataModule, metaclass=ABCMeta):\n    test_transform: Optional[Transforms]\n\n\n@DLDataModule.register("image_folder")\nclass ImageFolderData(CVDataModule):\n    def __init__(\n        self,\n        folder: str,\n        *,\n        batch_size: int,\n        num_workers: int = 0,\n        shuffle: bool = True,\n        drop_train_last: bool = True,\n        prefetch_device: Optional[Union[int, str]] = None,\n        pin_memory_device: Optional[Union[int, str]] = None,\n        extra_label_names: Optional[List[str]] = None,\n        transform: Optional[Union[str, List[str], Transforms, Callable]] = None,\n        transform_config: Optional[Dict[str, Any]] = None,\n        test_shuffle: Optional[bool] = None,\n        test_transform: Optional[Union[str, List[str], Transforms, Callable]] = None,\n        test_transform_config: Optional[Dict[str, Any]] = None,\n        lmdb_config: Optional[Dict[str, Any]] = None,\n    ):\n')),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"folder")),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify the path to the unified ",Object(l.b)("strong",{parentName:"li"},"IFD"),"."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"batch_size")),Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify the number of samples in each batch."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"num_workers"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"0"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Argument used in ",Object(l.b)("inlineCode",{parentName:"li"},"loader"),"."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"shuffle"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"True"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Argument used in ",Object(l.b)("inlineCode",{parentName:"li"},"loader"),"."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"drop_train_last"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"True"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Whether should we apply ",Object(l.b)("inlineCode",{parentName:"li"},"drop_last")," in ",Object(l.b)("inlineCode",{parentName:"li"},"loader")," in training set."),Object(l.b)("li",{parentName:"ul"},"Notice that for validation set, ",Object(l.b)("inlineCode",{parentName:"li"},"drop_last")," will always be ",Object(l.b)("inlineCode",{parentName:"li"},"False"),"."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"prefetch_device"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"None"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"If not specified, the ",Object(l.b)("inlineCode",{parentName:"li"},"prefetch")," mechanism will not be applied."),Object(l.b)("li",{parentName:"ul"},"If specified, ",Object(l.b)("inlineCode",{parentName:"li"},"carefree-learn")," will 'prefetch' each batch to the corresponding device."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"pin_memory_device"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"None"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"If not specified, the ",Object(l.b)("inlineCode",{parentName:"li"},"pin_memory")," mechanism will not be applied."),Object(l.b)("li",{parentName:"ul"},"If specified, ",Object(l.b)("inlineCode",{parentName:"li"},"carefree-learn")," will use ",Object(l.b)("inlineCode",{parentName:"li"},"pin_memory")," in ",Object(l.b)("inlineCode",{parentName:"li"},"loader")," to the corresponding device."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"extra_label_names"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"None"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Should be the value of the ",Object(l.b)("inlineCode",{parentName:"li"},"extra_labels")," property in ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"#_preparationprotocol"}),Object(l.b)("inlineCode",{parentName:"a"},"_PreparationProtocol")),"."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"transform"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"None"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify the transform we would like to apply to the original batch."),Object(l.b)("li",{parentName:"ul"},"See ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"#transforms"}),"Transforms")," section for more details."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"transform_config"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"None"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify the configuration of ",Object(l.b)("inlineCode",{parentName:"li"},"transform"),"."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"test_shuffle"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"None"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Argument used in ",Object(l.b)("inlineCode",{parentName:"li"},"loader")," in test set."),Object(l.b)("li",{parentName:"ul"},"If not specified, it will be the same as ",Object(l.b)("inlineCode",{parentName:"li"},"shuffle"),"."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"test_transform"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"None"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify the transform we would like to apply to the original batch."),Object(l.b)("li",{parentName:"ul"},"If not specified, it will be the same as ",Object(l.b)("inlineCode",{parentName:"li"},"transform"),"."),Object(l.b)("li",{parentName:"ul"},"See ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"#transforms"}),"Transforms")," section for more details."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"test_transform_config"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"None"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify the configuration of ",Object(l.b)("inlineCode",{parentName:"li"},"test_transform"),"."),Object(l.b)("li",{parentName:"ul"},"If not specified, it will be the same as ",Object(l.b)("inlineCode",{parentName:"li"},"transform_config"),"."))),Object(l.b)("li",{parentName:"ul"},Object(l.b)("strong",{parentName:"li"},Object(l.b)("inlineCode",{parentName:"strong"},"lmdb_config"))," ","[default = ",Object(l.b)("inlineCode",{parentName:"li"},"None"),"]",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"Specify the configurations for ",Object(l.b)("inlineCode",{parentName:"li"},"lmdb"),"."),Object(l.b)("li",{parentName:"ul"},"If not provided, ",Object(l.b)("inlineCode",{parentName:"li"},"lmdb")," will not be utilized."),Object(l.b)("li",{parentName:"ul"},"Should be the same as ",Object(l.b)("inlineCode",{parentName:"li"},"lmdb_config")," used in ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"#prepare_image_folder"}),Object(l.b)("inlineCode",{parentName:"a"},"prepare_image_folder")),".")))),Object(l.b)("h3",{id:"prepare_image_folder_data"},Object(l.b)("inlineCode",{parentName:"h3"},"prepare_image_folder_data")),Object(l.b)("p",null,"To make things easier, ",Object(l.b)("inlineCode",{parentName:"p"},"carefree-learn")," provides ",Object(l.b)("inlineCode",{parentName:"p"},"prepare_image_folder_data")," API to directly construct a ",Object(l.b)("inlineCode",{parentName:"p"},"ImageFolderData")," from the original ",Object(l.b)("strong",{parentName:"p"},"IFD"),":"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),"def prepare_image_folder_data(\n    src_folder: str,\n    tgt_folder: str,\n    *,\n    to_index: bool,\n    batch_size: int,\n    prefix: Optional[str] = None,\n    preparation: _PreparationProtocol = DefaultPreparation(),\n    num_workers: int = 0,\n    shuffle: bool = True,\n    drop_train_last: bool = True,\n    prefetch_device: Optional[Union[int, str]] = None,\n    pin_memory_device: Optional[Union[int, str]] = None,\n    transform: Optional[Union[str, List[str], Transforms, Callable]] = None,\n    transform_config: Optional[Dict[str, Any]] = None,\n    test_shuffle: Optional[bool] = None,\n    test_transform: Optional[Union[str, List[str], Transforms, Callable]] = None,\n    test_transform_config: Optional[Dict[str, Any]] = None,\n    train_all_data: bool = False,\n    force_rerun: bool = False,\n    extensions: Optional[Set[str]] = None,\n    make_labels_in_parallel: bool = False,\n    num_jobs: int = 8,\n    valid_split: Union[int, float] = 0.1,\n    max_num_valid: int = 10000,\n    lmdb_config: Optional[Dict[str, Any]] = None,\n    use_tqdm: bool = True,\n) -> PrepareResults:\n    tgt_folder = prepare_image_folder(\n        src_folder,\n        tgt_folder,\n        to_index=to_index,\n        prefix=prefix,\n        preparation=preparation,\n        force_rerun=force_rerun,\n        extensions=extensions,\n        make_labels_in_parallel=make_labels_in_parallel,\n        num_jobs=num_jobs,\n        train_all_data=train_all_data,\n        valid_split=valid_split,\n        max_num_valid=max_num_valid,\n        lmdb_config=lmdb_config,\n        use_tqdm=use_tqdm,\n    )\n    data = ImageFolderData(\n        tgt_folder,\n        batch_size=batch_size,\n        num_workers=num_workers,\n        shuffle=shuffle,\n        drop_train_last=drop_train_last,\n        prefetch_device=prefetch_device,\n        pin_memory_device=pin_memory_device,\n        extra_label_names=preparation.extra_labels,\n        transform=transform,\n        transform_config=transform_config,\n        test_shuffle=test_shuffle,\n        test_transform=test_transform,\n        test_transform_config=test_transform_config,\n        lmdb_config=lmdb_config,\n    )\n    # `PrepareResults` is a `NamedTuple`\n    return PrepareResults(data, tgt_folder)\n")),Object(l.b)("h2",{id:"transforms"},"Transforms"),Object(l.b)("blockquote",null,Object(l.b)("p",{parentName:"blockquote"},"Source code: ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/carefree0910/carefree-learn/tree/dev/cflearn/api/cv/data/transforms"}),"transforms"))),Object(l.b)("p",null,"Data augmentation plays an important role in Computer Vision. In ",Object(l.b)("inlineCode",{parentName:"p"},"carefree-learn"),", we provided three kinds of transforms to apply data augmentations:"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"PyTorch native transforms: ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/carefree0910/carefree-learn/blob/99c946ffa1df2b821161d52aae19f67e91abf46e/cflearn/api/cv/data/transforms/pt.py"}),"pt.py"),"."),Object(l.b)("li",{parentName:"ul"},Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/albumentations-team/albumentations"}),"albumentations")," transforms: ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/carefree0910/carefree-learn/blob/99c946ffa1df2b821161d52aae19f67e91abf46e/cflearn/api/cv/data/transforms/A.py"}),"A.py"),"."),Object(l.b)("li",{parentName:"ul"},"Some commonly used transform pipelines: ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/carefree0910/carefree-learn/blob/99c946ffa1df2b821161d52aae19f67e91abf46e/cflearn/api/cv/data/transforms/interface.py"}),"interface.py"),".")),Object(l.b)("p",null,"These transforms are managed under the ",Object(l.b)("a",Object(n.a)({parentName:"p"},{href:"../design-principles#register-mechanism"}),"register mechanism"),", so we can access them by their names:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),'import cflearn\n\ndata = cflearn.prepare_image_folder_data(..., transform="to_tensor")\n')),Object(l.b)("p",null,"Where ",Object(l.b)("inlineCode",{parentName:"p"},"to_tensor")," transform is defined as follows:"),Object(l.b)("pre",null,Object(l.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),'@Transforms.register("to_tensor")\nclass ToTensor(NoBatchTransforms):\n    fn = transforms.ToTensor()\n')),Object(l.b)("div",{className:"admonition admonition-tip alert alert--success"},Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(l.b)("h5",{parentName:"div"},Object(l.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(l.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"}),Object(l.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})))),"tip")),Object(l.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(l.b)("ul",{parentName:"div"},Object(l.b)("li",{parentName:"ul"},"For supported transforms, please refer to the ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/carefree0910/carefree-learn/tree/dev/cflearn/api/cv/data/transforms"}),"source code"),"."),Object(l.b)("li",{parentName:"ul"},"For customizing transforms, please refer to the ",Object(l.b)("a",Object(n.a)({parentName:"li"},{href:"../developer-guides/computer-vision-customization#customize-transforms"}),"Customize Transforms")," section.")))))}m.isMDXComponent=!0},96:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return u}));var n=a(0),r=a.n(n);function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function b(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=r.a.createContext({}),p=function(e){var t=r.a.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},s=function(e){var t=p(e.components);return r.a.createElement(c.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,l=e.originalType,i=e.parentName,c=b(e,["components","mdxType","originalType","parentName"]),s=p(a),d=n,u=s["".concat(i,".").concat(d)]||s[d]||m[d]||l;return a?r.a.createElement(u,o(o({ref:t},c),{},{components:a})):r.a.createElement(u,o({ref:t},c))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=a.length,i=new Array(l);i[0]=d;var o={};for(var b in t)hasOwnProperty.call(t,b)&&(o[b]=t[b]);o.originalType=e,o.mdxType="string"==typeof e?e:n,i[1]=o;for(var c=2;c<l;c++)i[c]=a[c];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,a)}d.displayName="MDXCreateElement"},97:function(e,t,a){"use strict";function n(e){var t,a,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(a=n(e[t]))&&(r&&(r+=" "),r+=a);else for(t in e)e[t]&&(r&&(r+=" "),r+=t);return r}t.a=function(){for(var e,t,a=0,r="";a<arguments.length;)(e=arguments[a++])&&(t=n(e))&&(r&&(r+=" "),r+=t);return r}}}]);